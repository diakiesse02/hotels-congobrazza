<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ajouter un Hôtel</title>
</head>
<body>
  <h2>Formulaire d'ajout d'hôtel</h2>
  <form id="hotelForm">
    <input type="text" name="nom" placeholder="Nom de l'hôtel" required><br>
    <input type="text" name="adresse" placeholder="Adresse" required><br>
    <textarea name="description" placeholder="Description" required></textarea><br>
    <input type="file" id="imageInput" accept="image/*" required><br>
    <button type="submit">Envoyer</button>
  </form>

  <p id="status"></p>

  <script>
    const form = document.getElementById("hotelForm");
    const status = document.getElementById("status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      status.innerText = "Téléchargement de l’image...";

      const imageFile = document.getElementById("imageInput").files[0];
      const cloudName = "TON_CLOUD_NAME";
      const uploadPreset = "github_upload";

      const formData = new FormData();
      formData.append("file", imageFile);
      formData.append("upload_preset", uploadPreset);

      try {
        // 1. Upload image vers Cloudinary
        const cloudinaryRes = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/upload`, {
          method: "POST",
          body: formData
        });
        const cloudinaryData = await cloudinaryRes.json();
        const imageURL = cloudinaryData.secure_url;

        status.innerText = "Envoi des données à Airtable...";

        // 2. Envoyer texte + imageURL à Airtable via NoCodeAPI
        const nom = form.nom.value;
        const adresse = form.adresse.value;
        const description = form.description.value;

        const airtableRes = await fetch("https://v1.nocodeapi.com/TON_NOM_UTILISATEUR/airtable/TON_ENDPOINT_ID?tableName=Formulaire", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            fields: {
              "Nom": nom,
              "Adresse": adresse,
              "Description": description,
              "ImageURL": imageURL
            }
          })
        });

        const airtableData = await airtableRes.json();
        status.innerText = "✅ Hôtel ajouté avec succès !";
        form.reset();
      } catch (err) {
        console.error(err);
        status.innerText = "❌ Une erreur s'est produite.";
      }
    });
  </script>
</body>
</html>
