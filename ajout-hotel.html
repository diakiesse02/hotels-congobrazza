import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

// Initialisation Firebase
const storage = getStorage(app);

// Fonction de soumission
window.submitHotel = async function(event) {
  event.preventDefault();

  const nom = document.getElementById("nom").value;
  const adresse = document.getElementById("adresse").value;
  const ville = document.getElementById("ville").value;
  const telephone = document.getElementById("telephone").value;
  const email = document.getElementById("email").value;
  const site = document.getElementById("site").value;
  const chambres = document.getElementById("chambres").value;
  const description = document.getElementById("description").value;

  // Récupérer les services cochés
  const services = Array.from(document.querySelectorAll('input[name="services"]:checked')).map(cb => cb.value);

  // Récupérer les fichiers photo
  const photoFiles = document.getElementById("photos").files;
  const photoURLs = [];

  // Upload des images et récupération des URLs
  for (let i = 0; i < photoFiles.length; i++) {
    const file = photoFiles[i];
    const storageRef = ref(storage, `hotels/${nom}/${file.name}`);
    const snapshot = await uploadBytes(storageRef, file);
    const downloadURL = await getDownloadURL(snapshot.ref);
    photoURLs.push(downloadURL);
  }

  try {
    await addDoc(collection(db, "hotels"), {
      nom,
      adresse,
      ville,
      telephone,
      email,
      site,
      chambres,
      services,
      description,
      photos: photoURLs,
      dateAjout: new Date()
    });

    alert("Hôtel ajouté avec succès !");
    document.getElementById("form-hotel").reset();
  } catch (e) {
    alert("Erreur lors de l'enregistrement : " + e.message);
  }
}
