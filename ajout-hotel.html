<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ajouter un H√¥tel</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">

<div id="authSection" class="flex items-center justify-center h-screen">
  <button onclick="login()" class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700">
    üîê Se connecter avec Google
  </button>
</div>

<div id="formSection" class="hidden px-6 py-10 max-w-3xl mx-auto">
  <h1 class="text-3xl font-bold mb-6 text-center">‚ûï Ajouter un H√¥tel</h1>
  <form id="hotelForm" class="grid gap-4 md:grid-cols-2">
    <input type="text" placeholder="Nom de l'h√¥tel" id="hotelNom" required class="p-2 border rounded">
    <input type="text" placeholder="Ville" id="hotelVille" required class="p-2 border rounded">
    <input type="email" placeholder="Email" id="hotelEmail" required class="p-2 border rounded">
    <textarea placeholder="Description" id="hotelDescription" class="p-2 border rounded md:col-span-2"></textarea>
    <textarea placeholder="Services (ex: WiFi, Restaurant, Parking)" id="hotelServices" class="p-2 border rounded md:col-span-2"></textarea>
    <input type="file" id="hotelImages" accept="image/*" multiple class="md:col-span-2" />
    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 md:col-span-2">üì§ Enregistrer</button>
  </form>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import {
    getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import {
    getFirestore, collection, addDoc
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBo9JsPem6NqNWL1DHiPQFck5PLJvADRUI",
    authDomain: "congo-reservation.firebaseapp.com",
    projectId: "congo-reservation",
    storageBucket: "congo-reservation.appspot.com",
    messagingSenderId: "54528039217",
    appId: "1:54528039217:web:8158927e3b22c8a24a3810"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  const authorizedEmails = ["label.diak@gmail.com", "nkoukasylvanie@gmail.com"];

  getRedirectResult(auth).then((result) => {
    if (result?.user) {
      const email = result.user.email;
      if (authorizedEmails.includes(email)) {
        document.getElementById("authSection").classList.add("hidden");
        document.getElementById("formSection").classList.remove("hidden");
      } else {
        alert("‚õî Acc√®s refus√© √† " + email);
      }
    }
  }).catch((error) => console.error("Erreur d'auth:", error));

  window.login = () => signInWithRedirect(auth, provider);

  async function uploadToCloudinary(file) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', 'unsigned_upload');
    const response = await fetch('https://api.cloudinary.com/v1_1/dnemkgkyy/image/upload', {
      method: 'POST',
      body: formData
    });
    const data = await response.json();
    return data.secure_url;
  }

  document.getElementById("hotelForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const nom = document.getElementById("hotelNom").value;
    const ville = document.getElementById("hotelVille").value;
    const email = document.getElementById("hotelEmail").value;
    const description = document.getElementById("hotelDescription").value;
    const services = document.getElementById("hotelServices").value;
    const files = document.getElementById("hotelImages").files;
    const imageUrls = [];

    for (let i = 0; i < files.length; i++) {
      const url = await uploadToCloudinary(files[i]);
      imageUrls.push(url);
    }

    await addDoc(collection(db, "hotels"), {
      nom,
      ville,
      email,
      description,
      services,
      images: imageUrls,
      valid√©: false,
      publie: false
    });

    alert("‚úÖ H√¥tel ajout√© !");
    e.target.reset();
  });
</script>
</body>
</html>
