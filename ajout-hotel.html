<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Ajouter un Hôtel</title>
</head>
<body>
  <h2>Ajouter un Hôtel</h2>
  
  <div id="userInfo"></div>
  <button id="login">Se connecter avec Google</button>
  <button id="logout" style="display:none;">Se déconnecter</button>

  <form id="hotelForm" style="display:none;">
    <input type="text" id="nom" placeholder="Nom de l'hôtel" required><br>
    <input type="text" id="adresse" placeholder="Adresse" required><br>
    <input type="text" id="telephone" placeholder="Téléphone" required><br>
    <input type="url" id="site" placeholder="Site Web (facultatif)"><br>

    <label>Services :</label><br>
    <input type="checkbox" value="WiFi" name="services"> WiFi
    <input type="checkbox" value="Piscine" name="services"> Piscine
    <input type="checkbox" value="Parking" name="services"> Parking<br><br>

    <label>Images :</label>
    <input type="file" id="images" multiple required><br><br>

    <button type="submit">Envoyer</button>
  </form>

  <script type="module">
    import {
      db, auth, provider, signInWithPopup, onAuthStateChanged, signOut,
      collection, addDoc
    } from './firebase.js';

    const loginBtn = document.getElementById('login');
    const logoutBtn = document.getElementById('logout');
    const userInfo = document.getElementById('userInfo');
    const hotelForm = document.getElementById('hotelForm');

    loginBtn.onclick = () => signInWithPopup(auth, provider);
    logoutBtn.onclick = () => signOut(auth);

    onAuthStateChanged(auth, user => {
      if (user) {
        userInfo.innerText = `Connecté : ${user.email}`;
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline';
        hotelForm.style.display = 'block';
      } else {
        userInfo.innerText = '';
        loginBtn.style.display = 'inline';
        logoutBtn.style.display = 'none';
        hotelForm.style.display = 'none';
      }
    });

    hotelForm.onsubmit = async (e) => {
      e.preventDefault();

      const nom = document.getElementById('nom').value;
      const adresse = document.getElementById('adresse').value;
      const telephone = document.getElementById('telephone').value;
      const site = document.getElementById('site').value;
      const services = Array.from(document.querySelectorAll('input[name="services"]:checked')).map(cb => cb.value);
      const files = document.getElementById('images').files;

      const cloudName = "TON_CLOUD_NAME";
      const unsignedPreset = "TON_UNSIGNED_PRESET";
      const imageUrls = [];

      for (let file of files) {
        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", unsignedPreset);

        const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/upload`, {
          method: "POST",
          body: formData
        });
        const data = await res.json();
        imageUrls.push(data.secure_url);
      }

      await addDoc(collection(db, "hotels"), {
        nom, adresse, telephone, site, services, images: imageUrls,
        auteur: auth.currentUser.email,
        date: new Date().toISOString()
      });

      alert("Hôtel soumis avec succès !");
      hotelForm.reset();
    };
  </script>
</body>
</html>
